<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yt-dlp Web UI</title>
<link rel="stylesheet" href="/static/styles.css"/>
</head>
<body>
<header>
  <h1>yt-dlp Web Interface</h1>
  <div id="statusBadge" class="badge">Idle</div>
</header>

<main>
  <section class="hero-card">
    <div class="url-input-container">
      <input id="url" type="url" placeholder="Paste video URL…" autocomplete="on"/>
      <div class="button-group">
        <button id="btnStart">Download</button>
        <button id="btnStop" class="secondary">Cancel</button>
      </div>
    </div>
  </section>

  <details class="card" open>
    <summary>Core Options</summary>
    <div class="grid">
      <div class="field">
        <label>Output Directory <span class="info" title="The directory where the downloaded files will be saved. You can use the 'Browse' button to select a directory.">i</span></label>
        <div class="row">
          <input id="destination_dir" placeholder="/media/usb…"/>
          <button id="btnBrowsePaths" class="secondary">Browse</button>
        </div>
        <small id="pathsHint"></small>
      </div>

      <div class="field">
        <label>Output Filename <span class="info" title="The name of the downloaded file. You can use yt-dlp variables to customize the filename. See the yt-dlp documentation for a full list of available variables.">i</span></label>
        <input id="output_filename" placeholder="%(uploader)s/%(title)s.%(ext)s"/>
        <small>Variables: %(title)s, %(uploader)s, %(upload_date)s, %(ext)s, etc.</small>
      </div>

      <div class="field">
        <label>Archive log <span class="info" title="A file that keeps track of downloaded videos to avoid re-downloading them. Provide a path to a text file.">i</span></label>
        <input id="archive_path" placeholder="/mnt/usb/archive_log.txt"/>
      </div>
    </div>
  </details>

  <details class="card">
    <summary>Format & Quality</summary>
    <div class="row">
      <label><input type="radio" name="fmtmode" value="preset" checked> Preset</label>
      <label><input type="radio" name="fmtmode" value="custom"> Custom -f</label>
    </div>

    <div id="presetBox" class="grid">
      <div class="field">
        <label>Download type <span class="info" title="Choose whether to download video and audio, only video, or only audio.">i</span></label>
        <select id="dl_kind">
          <option value="video_audio">Video + Audio</option>
          <option value="video">Video only</option>
          <option value="audio">Audio only</option>
        </select>
      </div>
      <div class="field">
        <label>Max height ≤ <span class="info" title="Limit the vertical resolution of the video. For example, 1080 for 1080p video.">i</span></label>
        <input id="max_height" type="number" inputmode="numeric" placeholder="1080"/>
      </div>
      <div class="example">
        Example produced: <code id="fmtExample">bestvideo+bestaudio/best</code>
      </div>
    </div>

    <div id="customBox" class="field" style="display:none">
      <label>-f custom <span class="info" title="Directly pass a yt-dlp format selector. This gives you full control over the format selection.">i</span></label>
      <input id="custom_format" placeholder="bestvideo*[height<=1080]+bestaudio/best[height<=1080]/best"/>
    </div>
  </details>

  <details class="card">
    <summary>Rate & Sleep</summary>
    <div class="grid">
      <div class="field">
        <label>--limit-rate <span class="info" title="Limit the download speed, e.g., 10000k or 2M.">i</span></label>
        <input id="limit_rate" placeholder="10000k"/>
      </div>
      <div class="field">
        <label>--sleep-interval (s) <span class="info" title="The number of seconds to wait before each download.">i</span></label>
        <input id="sleep_interval" type="number" inputmode="numeric" placeholder="0"/>
      </div>
      <div class="field">
        <label>--max-sleep-interval (s) <span class="info" title="The maximum number of seconds to wait between downloads.">i</span></label>
        <input id="max_sleep_interval" type="number" inputmode="numeric" placeholder="0"/>
      </div>
    </div>
  </details>

  <details class="card">
    <summary>Flags</summary>
    <div class="flags">
      <label><input class="flag" type="checkbox" value="--no-abort-on-error"> --no-abort-on-error <span class="info" title="Continue downloading other videos in a playlist if one fails.">i</span></label>
      <label><input class="flag" type="checkbox" value="--skip-unavailable-fragments"> --skip-unavailable-fragments <span class="info" title="Skip unavailable fragments of a video.">i</span></label>
      <label><input class="flag" type="checkbox" value="--continue"> --continue <span class="info" title="Resume partially downloaded files.">i</span></label>
      <label><input class="flag" type="checkbox" value="--restrict-filenames" checked> --restrict-filenames <span class="info" title="Restrict filenames to only ASCII characters.">i</span></label>
      <label><input class="flag" type="checkbox" value="--windows-filenames"> --windows-filenames <span class="info" title="Make filenames compatible with Windows.">i</span></label>
      <label><input class="flag" type="checkbox" value="--embed-thumbnail" checked> --embed-thumbnail <span class="info" title="Embed the thumbnail in the audio file.">i</span></label>
      <label><input class="flag" type="checkbox" value="--embed-metadata" checked> --embed-metadata <span class="info" title="Embed metadata in the video file.">i</span></label>
      <label><input class="flag" type="checkbox" value="--embed-chapters" checked> --embed-chapters <span class="info" title="Embed chapter markers in the video file.">i</span></label>
      <label><input class="flag" type="checkbox" value="--write-description"> --write-description <span class="info" title="Write the video description to a .description file.">i</span></label>
      <label><input class="flag" type="checkbox" value="--write-info-json"> --write-info-json <span class="info" title="Write video metadata to a .info.json file.">i</span></label>
      <label><input class="flag" type="checkbox" value="--no-clean-info-json"> --no-clean-info-json <span class="info" title="Do not clean the .info.json file.">i</span></label>
      <label><input class="flag" type="checkbox" value="--write-subs"> --write-subs <span class="info" title="Download subtitles.">i</span></label>
      <label><input class="flag" type="checkbox" value="--no-simulate"> --no-simulate <span class="info" title="Do not simulate the download.">i</span></label>
      <label><input class="flag" type="checkbox" value="--no-ignore-no-formats-error"> --no-ignore-no-formats-error <span class="info" title="Do not ignore errors when no formats are available.">i</span></label>
      <label><input class="flag" type="checkbox" value="--list-formats"> --list-formats <span class="info" title="List all available formats for the video.">i</span></label>
      <label><input class="flag" type="checkbox" value="--list-subs"> --list-subs <span class="info" title="List all available subtitles for the video.">i</span></label>
      <label><input class="flag" type="checkbox" value="--progress" checked> --progress <span class="info" title="Show a progress bar.">i</span></label>
      <label><input class="flag" type="checkbox" value="--console-title"> --console-title <span class="info" title="Display progress in the console title.">i</span></label>
      <label><input class="flag" type="checkbox" value="--no-keep-fragments"> --no-keep-fragments <span class="info" title="Do not keep downloaded fragments.">i</span></label>
    </div>
  </details>

  <details class="card">
    <summary>USB Tools</summary>
    <div class="grid">
      <div class="field">
        <label>Disks and Usage</label>
        <div class="row">
          <button id="btnLsblk" class="secondary">List Disks</button>
          <button id="btnDf" class="secondary">Disk Usage</button>
        </div>
        <pre id="blkout" class="mono"></pre>
      </div>
      <div class="field">
        <label>Mount/Unmount</label>
        <div class="row">
          <input id="mount_dev" placeholder="/dev/sda1"/>
          <input id="mount_point" placeholder="/media/usb1"/>
        </div>
        <div class="row">
          <button id="btnMount">Mount</button>
          <button id="btnUmount" class="secondary">Unmount</button>
        </div>
      </div>
    </div>
  </details>

  <details class="card">
    <summary>Logs & Control</summary>
    <div class="row">
      <button id="btnFullscreen" class="secondary">Toggle full-screen</button>
    </div>
    <div id="progressWrap">
      <div id="progress"><span id="progressPct" style="width:0%"></span></div>
      <div id="progressText">0%</div>
    </div>
    <pre id="log" class="mono"></pre>
  </details>

  <details class="card">
    <summary>Run Custom Command</summary>
    <div class="row">
      <input id="rawCmd" placeholder="yt-dlp --help"/>
      <button id="btnRunRaw">Run</button>
    </div>
    <small>Warning: runs exactly as typed on the Pi.</small>
  </details>
</main>

<div id="fileBrowserModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>File Browser</h2>
      <button id="closeModal" class="close-button">&times;</button>
    </div>
    <div class="modal-body">
      <div id="fileBrowser" class="file-browser"></div>
    </div>
    <div class="modal-footer">
      <button id="selectPath" class="primary">Select Path</button>
    </div>
  </div>
</div>

<footer>
  <span>Server on Raspberry Pi. Browser is UI only.</span>
</footer>

<script src="/static/app.js"></script>
</body>
</html>